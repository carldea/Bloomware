package me.offeex.bloomware.client.module.modules.exploit;

import me.offeex.bloomware.client.command.CommandManager;
import me.offeex.bloomware.client.module.Module;
import me.offeex.bloomware.client.setting.settings.NumberSetting;
import net.minecraft.entity.player.PlayerEntity;
import net.minecraft.util.math.Vec3d;

import java.util.HashMap;
import java.util.Objects;

/*
Skidded from Summit
 */
public class PearlTracker extends Module {

    public PearlTracker() {
        super("PearlTracker", "Tracks player when it teleports by pearl", Category.EXPLOIT, false,
                new NumberSetting("Min distance", 10, 10, 200, 10));
    }

    private HashMap<String, Vec3d> PlayersFar = new HashMap<>();

    @Override
    public void onTick() {
        for (PlayerEntity player : mc.world.getPlayers()) {
            if (player == mc.player || player.getName() == Objects.requireNonNull(mc.player).getName())
                continue;

            if (player.distanceTo(mc.player) < 10) {
                if (PlayersFar.containsKey(player.getName().asString())) {
                    CommandManager.addChatMessage("Removing " + player.getName() + " from list, they are now in range at " + player.distanceTo(mc.player) + " distance");
                    PlayersFar.remove(player.getName().asString());
                }
                continue;
            }

            if (PlayersFar.containsKey(player.getName().asString()))
                continue;

            if (player.distanceTo(mc.player) >= ((NumberSetting) this.getSetting(0)).getValue()) {
                PlayersFar.put(player.getName().asString(), new Vec3d(player.getX(), player.getY(), player.getZ()));
                CommandManager.addChatMessage(player.getName().asString() + " just teleported to " + String.format("%.0f", player.getX()) + ", "+ String.format("%.1f", player.getZ()));
            }
        }
    }
}
